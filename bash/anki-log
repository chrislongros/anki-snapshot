#!/bin/bash
BACKUP_DIR="${ANKI_SNAPSHOT_DIR:-$HOME/anki-snapshot}"
cd "$BACKUP_DIR"
COUNT="${1:-10}"
echo -e "\033[1mâ”â”â” Anki Snapshot History â”â”â”\033[0m\n"
git log --oneline -n "$COUNT" --format="%h|%ci|%s" | while IFS='|' read -r hash timestamp msg; do
    stats=$(git diff --shortstat "${hash}^..${hash}" -- notes.txt 2>/dev/null)
    added=$(echo "$stats" | grep -oE '[0-9]+ insertion' | grep -oE '[0-9]+' || echo "0")
    removed=$(echo "$stats" | grep -oE '[0-9]+ deletion' | grep -oE '[0-9]+' || echo "0")
    ts=$(echo "$timestamp" | cut -d' ' -f1,2)
    if [[ "$added" -gt 0 && "$removed" -gt 0 ]]; then symbol="ğŸ“"
    elif [[ "$added" -gt 0 ]]; then symbol="âœ…"
    elif [[ "$removed" -gt 0 ]]; then symbol="ğŸ—‘ï¸"
    else symbol="â—‹"; fi
    echo -e "$symbol \033[33m$hash\033[0m \033[2m$ts\033[0m $msg \033[2m(+$added/-$removed)\033[0m"
done
echo -e "\n\033[2mUsage: anki-diff <hash>~1..<hash> to see specific changes\033[0m"
